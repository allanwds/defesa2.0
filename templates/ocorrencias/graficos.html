{% load extras %}
{% block content %}
<div class="container my-5">
    <!-- CabeÃ§alho -->
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold">ðŸ“Š RELATÃ“RIO DDEC-MB</h1>
        <p class="text-muted">EstatÃ­sticas atualizadas das ocorrÃªncias por tipo e distrito</p>
    </div>

    <!-- GrÃ¡ficos -->
    <div class="row justify-content-center g-4">
        <!-- GrÃ¡fico por Motivo -->
        <div class="col-lg-5 col-md-6">
            <div class="card shadow rounded-4">
                <div class="card-header text-center bg-white border-0">
                    <H3 class="fw-semibold mb-0">OCORRÃŠNCIAS POR TIPO/MOTIVO</h3>
                    <H4 class="text-muted">TOTAL GERAL: {{ total_motivos }}</H4>
                </div>
                <div class="card-body">
                    {% for motivo in motivos_count %}
                        <p class="mb-1"><strong>{{ motivo.motivo }}</strong>: {{ motivo.total }}</p>
                    {% endfor %}
                    <canvas id="graficoMotivos" width="200" height="120"></canvas>
                </div>
            </div>
        </div>

        <!-- GrÃ¡fico por Distrito -->
        <div class="col-lg-5 col-md-6">
            <div class="card shadow rounded-4">
                <div class="card-header text-center bg-white border-0">
                    <h3 class="fw-semibold mb-0">OCORRÃŠNCIAS POR DISTRITO</h3>
                    <H4 class="text-muted">TOTAL GERAL: {{ total_distritos }}</H4>
                </div>
                <div class="card-body">
                    {% for distrito in distritos_count %}
                        <p class="mb-1"><strong>{{ distrito.distrito }}</strong>: {{ distrito.total }}</p>
                    {% endfor %}
                    <canvas id="graficoDistritos" width="200" height="120"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    const motivosData = {
        labels: {{ motivos_count|pluck:"motivo"|safe }},
        datasets: [{
            label: 'OcorrÃªncias',
            data: {{ motivos_count|pluck:"total"|safe }},
            backgroundColor: [
                '#4bc0c0', '#ff6384', '#ffce56', '#36a2eb', '#9966ff'
            ],
            borderRadius: 6
        }]
    };

    const distritosData = {
        labels: {{ distritos_count|pluck:"distrito"|safe }},
        datasets: [{
            label: 'OcorrÃªncias',
            data: {{ distritos_count|pluck:"total"|safe }},
            backgroundColor: [
                '#ff9f40', '#36a2eb', '#4bc0c0', '#ffcd56', '#9966ff'
            ],
            hoverOffset: 10
        }]
    };

    new Chart(document.getElementById('graficoMotivos'), {
        type: 'bar',
        data: motivosData,
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: (ctx) => `${ctx.raw} ocorrÃªncias`
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { stepSize: 1 }
                }
            }
        }
    });

    new Chart(document.getElementById('graficoDistritos'), {
        type: 'doughnut',
        data: distritosData,
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom' },
                tooltip: {
                    callbacks: {
                        label: (ctx) => `${ctx.raw} ocorrÃªncias`
                    }
                }
            }
        }
    });
</script>
{% endblock %}
